<div ng-controller="game-Ctrl">
  <h2>Trump Inc</h2>
    <timer countdown="10" interval="1000" finish-callback="update()">Time unil next day: {{countdown}}</timer>
    <table class="table">
      <tr>
        <td>
          <div id="graph"></div> 
        </td>
        <td>
          <img src="res/img/trump-head.png" alt="TRUMP HEAD">
        </td>
        <td>
          <p class="{red: money > 0}">Funds: {{ money | currency }}</p></br>
          Allocated Budget: {{getBudgetUsed()|currency}}</br>
          Button 1 stock: {{ button1stock }}</br>
          Button 2 stock: {{ button2stock }}</br>
          Supply : {{supply1}}, {{supply2}}</br>
          Demand : {{demand1}}, {{demand2}}
        </td>
      </tr>
      <tr>
        <td>
          <div>
            <label for="quality">Production Quality: {{production.quality}}%</label>
            <input type="range" min="1" max="100" name="quality" 
                  ng-model="production.quality">
            <label for="quantity1">Button 1 Production count: {{production.quantity1}} (max {{getMaxProd1()}})</label>
            <input type="range" min="0" max={{getMaxProd1()}} ng-change="updateQuantity()" ng-model="production.quantity1">
            
            <label for="quantity1">Button 2 Production count: {{production.quantity2}} (max {{getMaxProd2()}})</label>
          <input type="range" min="0" max={{getMaxProd2()}} ng-change="updateQuantity()" ng-model="production.quantity2">
          </input>
          </div>
        </td>
        <td>
          <img src="res/img/trump-body.png" alt="TRUMP BODY">
        </td>
        <td>
          <button ng-click="buyButton1()" class="btn">Buy Button 1 ({{priceArray1[dayMax]|currency}})</button><br>
          <button ng-click="buyButton2()" class="btn">Buy Button 2 ({{priceArray2[dayMax]|currency}})</button><br>
         <button ng-click="sellButton1()" class="btn">Sell Button 1 ({{priceArray1[dayMax]|currency}})</button><br>
          <button ng-click="sellButton2()" class="btn">Sell Button 2 ({{priceArray2[dayMax]|currency}})</button><br>        
      </td>
     </tr>
      <tr>
        <td>More upgrades?</td>
        <td><img src="res/img/trump-stump.png" alt="TRUMP STUMP"></td>
        <td>SELL BUTTON</td>
      </tr>
    </table>
  <script type="text/javascript-lazy">
      var dom_el = document.querySelector('[ng-controller="game-Ctrl"]');
      var ng_el = angular.element(dom_el);
      var scope = ng_el.scope();
      //Set initial data
      var seed = 50;
      var priceArray = [scope.button1cost];
      var priceArray2 = [scope.button2cost];
      var karr = [];
      for (i = 0; i < scope.dayMax; i++) {
        priceArray.push(Math.round(100*(priceArray[i] + 5*Math.random()*(Math.random()<0.5?-1:1)))/100);
        priceArray2.push(Math.round(100*(priceArray2[i] + 5*Math.random()*(Math.random()<0.5?-1:1)))/100);
        karr.push(i+1);
      }
      var c = function() {
        scope.priceArray1 = priceArray;
        scope.priceArray2 = priceArray2;
      };
      var phase = scope.$$phase;
      if(phase == '$apply' || phase == '$digest') {
        if(c) {  
            c(); 
        }
      } else {
        scope.$apply(c);
      } 

      var data = {x: karr, y: priceArray, name: "Button 1", type: 'scatter'};       
      var data2 = {x: karr, y: priceArray2, name: "Button 2",  type: 'scatter'};
      var layout = {title: "Button Market", yaxis: { title: "Price ($)" }, 
                    xaxis: {title: "Days"}, margin: {l: 40, b: 30, t: 30, r:30}};
      Plotly.newPlot("graph", [data, data2], layout);
  </script>
</div>
